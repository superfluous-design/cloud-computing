{"version":3,"file":"SqlEventJournal.js","names":["EventJournal","Effect","Layer","PubSub","Schema","Uuid","SqlClient","SqlSchema","make","options","gen","sql","entryTable","remotesTable","onDialectOrElse","pg","withoutTransform","mysql","mssql","orElse","EntrySqlEncoded","EntrySqlPg","EntrySqlSqlite","EntrySql","transform","Entry","decode","fromA","id","event","primaryKey","primary_key","payload","encode","toI","timestamp","Date","entryIdMillis","EntrySqlArray","Array","decodeEntrySqlArray","decodeUnknown","insertEntry","void","Request","execute","entry","insert","insertEntries","insertRemotes","RemoteSql","pubsub","unbounded","of","entries","pipe","flatMap","mapError","cause","EventJournalError","method","write","effect","makeEntryId","disableValidation","value","publish","withTransaction","writeFromRemote","remotes","remoteEntry","push","remote_id","remoteId","entry_id","sequence","remoteSequence","existingIds","Set","in","map","e","tap","rows","row","add","stringify","uncommited","filter","has","idString","brackets","compact","_","compacted","i","length","conflicts","createdAtMillis","withRemoteUncommited","f","nextRemoteSequence","Number","max","changes","subscribe","destroy","layer","Struct","Uint8ArrayFromSelf","String","DateFromSelf","DateFromNumber","RemoteId","EntryId"],"sources":["../../src/SqlEventJournal.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,YAAY,MAAM,mCAAmC;AACjE,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,IAAI,MAAM,MAAM;AAC5B,OAAO,KAAKC,SAAS,MAAM,gBAAgB;AAE3C,OAAO,KAAKC,SAAS,MAAM,gBAAgB;AAE3C;;;;AAIA,OAAO,MAAMC,IAAI,GAAIC,OAGpB,IAKCR,MAAM,CAACS,GAAG,CAAC,aAAS;EAClB,MAAMC,GAAG,GAAG,OAAOL,SAAS,CAACA,SAAS;EAEtC,MAAMM,UAAU,GAAGH,OAAO,EAAEG,UAAU,IAAI,sBAAsB;EAChE,MAAMC,YAAY,GAAGJ,OAAO,EAAEI,YAAY,IAAI,sBAAsB;EAEpE,OAAOF,GAAG,CAACG,eAAe,CAAC;IACzBC,EAAE,EAAEA,CAAA,KACFJ,GAAG;uCAC4BA,GAAG,CAACC,UAAU,CAAC;;;;;;YAM1C,CAACI,gBAAgB;IACvBC,KAAK,EAAEA,CAAA,KACLN,GAAG;uCAC4BA,GAAG,CAACC,UAAU,CAAC;;;;;;YAM1C,CAACI,gBAAgB;IACvBE,KAAK,EAAEA,CAAA,KACLP,GAAG;uCAC4BA,GAAG,CAACC,UAAU,CAAC;;;;;;YAM1C,CAACI,gBAAgB;IACvBG,MAAM,EAAEA,CAAA,KACNR,GAAG;uCAC4BA,GAAG,CAACC,UAAU,CAAC;;;;;;YAM1C,CAACI;GACR,CAAC;EAEF,OAAOL,GAAG,CAACG,eAAe,CAAC;IACzBC,EAAE,EAAEA,CAAA,KACFJ,GAAG;uCAC4BA,GAAG,CAACE,YAAY,CAAC;;;;;YAK5C,CAACG,gBAAgB;IACvBC,KAAK,EAAEA,CAAA,KACLN,GAAG;uCAC4BA,GAAG,CAACE,YAAY,CAAC;;;;;YAK5C,CAACG,gBAAgB;IACvBE,KAAK,EAAEA,CAAA,KACLP,GAAG;uCAC4BA,GAAG,CAACE,YAAY,CAAC;;;;;YAK5C,CAACG,gBAAgB;IACvBG,MAAM,EAAEA,CAAA,KACNR,GAAG;uCAC4BA,GAAG,CAACE,YAAY,CAAC;;;;;YAK5C,CAACG;GACR,CAAC;EAEF,MAAMI,eAAe,GAAGT,GAAG,CAACG,eAAe,CAAC;IAC1CC,EAAE,EAAEA,CAAA,KAAMM,UAAU;IACpBJ,KAAK,EAAEA,CAAA,KAAMI,UAAU;IACvBH,KAAK,EAAEA,CAAA,KAAMG,UAAU;IACvBF,MAAM,EAAEA,CAAA,KAAMG;GACf,CAAC;EAEF,MAAMC,QAAQ,GAAGnB,MAAM,CAACoB,SAAS,CAC/BJ,eAAe,EACfpB,YAAY,CAACyB,KAAK,EAClB;IACEC,MAAMA,CAACC,KAAK;MACV,OAAO;QACLC,EAAE,EAAED,KAAK,CAACC,EAAE;QACZC,KAAK,EAAEF,KAAK,CAACE,KAAK;QAClBC,UAAU,EAAEH,KAAK,CAACI,WAAW;QAC7BC,OAAO,EAAEL,KAAK,CAACK;OAChB;IACH,CAAC;IACDC,MAAMA,CAACC,GAAG;MACR,OAAO;QACLN,EAAE,EAAEM,GAAG,CAACN,EAAE;QACVC,KAAK,EAAEK,GAAG,CAACL,KAAK;QAChBE,WAAW,EAAEG,GAAG,CAACJ,UAAU;QAC3BE,OAAO,EAAEE,GAAG,CAACF,OAAO;QACpBG,SAAS,EAAE,IAAIC,IAAI,CAACpC,YAAY,CAACqC,aAAa,CAACH,GAAG,CAACN,EAA0B,CAAC;OAC/E;IACH;GACD,CACF;EACD,MAAMU,aAAa,GAAGlC,MAAM,CAACmC,KAAK,CAAChB,QAAQ,CAAC;EAC5C,MAAMiB,mBAAmB,GAAGpC,MAAM,CAACqC,aAAa,CAACH,aAAa,CAAC;EAE/D,MAAMI,WAAW,GAAGnC,SAAS,CAACoC,IAAI,CAAC;IACjCC,OAAO,EAAErB,QAAQ;IACjBsB,OAAO,EAAGC,KAAK,IACbnC,GAAG,eAAeA,GAAG,CAACC,UAAU,CAAC,IAAID,GAAG,CAACoC,MAAM,CAACD,KAAK,CAAC,yBAAyB,CAAC9B;GACnF,CAAC;EACF,MAAMgC,aAAa,GAAGzC,SAAS,CAACoC,IAAI,CAAC;IACnCC,OAAO,EAAExC,MAAM,CAACmC,KAAK,CAAChB,QAAQ,CAAC;IAC/BsB,OAAO,EAAGC,KAAK,IACbnC,GAAG,eAAeA,GAAG,CAACC,UAAU,CAAC,IAAID,GAAG,CAACoC,MAAM,CAACD,KAAK,CAAC,yBAAyB,CAAC9B;GACnF,CAAC;EACF,MAAMiC,aAAa,GAAG1C,SAAS,CAACoC,IAAI,CAAC;IACnCC,OAAO,EAAExC,MAAM,CAACmC,KAAK,CAACW,SAAS,CAAC;IAChCL,OAAO,EAAGC,KAAK,IACbnC,GAAG,eAAeA,GAAG,CAACE,YAAY,CAAC,IAAIF,GAAG,CAACoC,MAAM,CAACD,KAAK,CAAC,yBAAyB,CAAC9B;GACrF,CAAC;EAEF,MAAMmC,MAAM,GAAG,OAAOhD,MAAM,CAACiD,SAAS,EAAsB;EAE5D,OAAOpD,YAAY,CAACA,YAAY,CAACqD,EAAE,CAAC;IAClCC,OAAO,EAAE3C,GAAG,iBAAiBA,GAAG,CAACC,UAAU,CAAC,yBAAyB,CAACI,gBAAgB,CAACuC,IAAI,CACzFtD,MAAM,CAACuD,OAAO,CAAChB,mBAAmB,CAAC,EACnCvC,MAAM,CAACwD,QAAQ,CAAEC,KAAK,IAAK,IAAI1D,YAAY,CAAC2D,iBAAiB,CAAC;MAAED,KAAK;MAAEE,MAAM,EAAE;IAAS,CAAE,CAAC,CAAC,CAC7F;IACDC,KAAKA,CAAC;MAAEC,MAAM;MAAEjC,KAAK;MAAEG,OAAO;MAAEF;IAAU,CAAE;MAC1C,OAAO7B,MAAM,CAACS,GAAG,CAAC,aAAS;QACzB,MAAMoC,KAAK,GAAG,IAAI9C,YAAY,CAACyB,KAAK,CAAC;UACnCG,EAAE,EAAE5B,YAAY,CAAC+D,WAAW,EAAE;UAC9BlC,KAAK;UACLC,UAAU;UACVE;SACD,EAAE;UAAEgC,iBAAiB,EAAE;QAAI,CAAE,CAAC;QAC/B,OAAOtB,WAAW,CAACI,KAAK,CAAC;QACzB,MAAMmB,KAAK,GAAG,OAAOH,MAAM,CAAChB,KAAK,CAAC;QAClC,OAAOK,MAAM,CAACe,OAAO,CAACpB,KAAK,CAAC;QAC5B,OAAOmB,KAAK;MACd,CAAC,CAAC,CAACV,IAAI,CACL5C,GAAG,CAACwD,eAAe,EACnBlE,MAAM,CAACwD,QAAQ,CAAEC,KAAK,IACpB,IAAI1D,YAAY,CAAC2D,iBAAiB,CAAC;QACjCD,KAAK;QACLE,MAAM,EAAE;OACT,CAAC,CACH,CACF;IACH,CAAC;IACDQ,eAAe,EAAG3D,OAAO,IACvBR,MAAM,CAACS,GAAG,CAAC,aAAS;MAClB,MAAM4C,OAAO,GAA8B,EAAE;MAC7C,MAAMe,OAAO,GAAiC,EAAE;MAChD,KAAK,MAAMC,WAAW,IAAI7D,OAAO,CAAC6C,OAAO,EAAE;QACzCA,OAAO,CAACiB,IAAI,CAACD,WAAW,CAACxB,KAAK,CAAC;QAC/BuB,OAAO,CAACE,IAAI,CAAC;UACXC,SAAS,EAAE/D,OAAO,CAACgE,QAAQ;UAC3BC,QAAQ,EAAEJ,WAAW,CAACxB,KAAK,CAAClB,EAAE;UAC9B+C,QAAQ,EAAEL,WAAW,CAACM;SACvB,CAAC;MACJ;MACA,MAAMC,WAAW,GAAG,IAAIC,GAAG,EAAU;MACrC,OAAOnE,GAAuB,kBAAkBA,GAAG,CAACC,UAAU,CAAC,UAC7DD,GAAG,CAACoE,EAAE,CAAC,IAAI,EAAEzB,OAAO,CAAC0B,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACrD,EAAE,CAAC,CACvC,EAAE,CAAC2B,IAAI,CAACtD,MAAM,CAACiF,GAAG,CAAEC,IAAI,IAAI;QAC1B,KAAK,MAAMC,GAAG,IAAID,IAAI,EAAE;UACtBN,WAAW,CAACQ,GAAG,CAAChF,IAAI,CAACiF,SAAS,CAACF,GAAG,CAACxD,EAAE,CAAC,CAAC;QACzC;MACF,CAAC,CAAC,CAAC;MACH,OAAOoB,aAAa,CAACM,OAAO,CAAC;MAC7B,OAAOL,aAAa,CAACoB,OAAO,CAAC;MAE7B,MAAMkB,UAAU,GAAG9E,OAAO,CAAC6C,OAAO,CAACkC,MAAM,CAAEP,CAAC,IAAK,CAACJ,WAAW,CAACY,GAAG,CAACR,CAAC,CAACnC,KAAK,CAAC4C,QAAQ,CAAC,CAAC;MACpF,MAAMC,QAAQ,GAAGlF,OAAO,CAACmF,OAAO,GAC5B,OAAOnF,OAAO,CAACmF,OAAO,CAACL,UAAU,CAAC,GAClC,CAAC,CAACA,UAAU,CAACP,GAAG,CAAEa,CAAC,IAAKA,CAAC,CAAC/C,KAAK,CAAC,EAAEyC,UAAU,CAAU,CAAC;MAC3D,KAAK,MAAM,CAACO,SAAS,CAAC,IAAIH,QAAQ,EAAE;QAClC,KAAK,IAAII,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,SAAS,CAACE,MAAM,EAAED,CAAC,EAAE,EAAE;UACzC,MAAMjD,KAAK,GAAGgD,SAAS,CAACC,CAAC,CAAC;UAC1B,MAAME,SAAS,GAAG,OAAOtF,GAAG;;uBAEnBA,GAAG,CAACC,UAAU,CAAC;gCACNkC,KAAK,CAACjB,KAAK;sCACLiB,KAAK,CAAChB,UAAU;qCACjBgB,KAAK,CAACoD,eAAe;;eAE3C,CAAC3C,IAAI,CACJtD,MAAM,CAACuD,OAAO,CAAChB,mBAAmB,CAAC,CACpC;UACD,OAAO/B,OAAO,CAACqD,MAAM,CAAC;YAAEhB,KAAK;YAAEmD;UAAS,CAAE,CAAC;QAC7C;MACF;IACF,CAAC,CAAC,CAAC1C,IAAI,CACL5C,GAAG,CAACwD,eAAe,EACnBlE,MAAM,CAACwD,QAAQ,CAAEC,KAAK,IACpB,IAAI1D,YAAY,CAAC2D,iBAAiB,CAAC;MACjCD,KAAK;MACLE,MAAM,EAAE;KACT,CAAC,CACH,CACF;IACHuC,oBAAoB,EAAEA,CAAC1B,QAAQ,EAAE2B,CAAC,KAChCnG,MAAM,CAACS,GAAG,CAAC,aAAS;MAClB,MAAM4C,OAAO,GAAG,OAAO3C,GAAG;;mBAEjBA,GAAG,CAACC,UAAU,CAAC;oDACkBD,GAAG,CAACE,YAAY,CAAC,sBAAsB4D,QAAQ;;WAExF,CAAClB,IAAI,CACJtD,MAAM,CAACuD,OAAO,CAAChB,mBAAmB,CAAC,CACpC;MACD,OAAO,OAAO4D,CAAC,CAAC9C,OAAO,CAAC;IAC1B,CAAC,CAAC,CAACC,IAAI,CACL5C,GAAG,CAACwD,eAAe,EACnBlE,MAAM,CAACwD,QAAQ,CAAEC,KAAK,IACpB,IAAI1D,YAAY,CAAC2D,iBAAiB,CAAC;MACjCD,KAAK;MACLE,MAAM,EAAE;KACT,CAAC,CACH,CACF;IACHyC,kBAAkB,EAAG5B,QAAQ,IAC3B9D,GAAoB,oCAAoCA,GAAG,CAACE,YAAY,CAAC,sBAAsB4D,QAAQ,EAAE,CAAClB,IAAI,CAC5GtD,MAAM,CAAC+E,GAAG,CAAEG,IAAI,IAAKmB,MAAM,CAACnB,IAAI,CAAC,CAAC,CAAE,CAACoB,GAAG,CAAC,GAAG,CAAC,CAAC,EAC9CtG,MAAM,CAACwD,QAAQ,CAAEC,KAAK,IACpB,IAAI1D,YAAY,CAAC2D,iBAAiB,CAAC;MACjCD,KAAK;MACLE,MAAM,EAAE;KACT,CAAC,CACH,CACF;IACH4C,OAAO,EAAErG,MAAM,CAACsG,SAAS,CAACtD,MAAM,CAAC;IACjCuD,OAAO,EAAEzG,MAAM,CAACS,GAAG,CAAC,aAAS;MAC3B,OAAOC,GAAG,cAAcA,GAAG,CAACC,UAAU,CAAC,EAAE,CAACI,gBAAgB;MAC1D,OAAOL,GAAG,cAAcA,GAAG,CAACE,YAAY,CAAC,EAAE,CAACG,gBAAgB;IAC9D,CAAC,CAAC,CAACuC,IAAI,CACLtD,MAAM,CAACwD,QAAQ,CAAEC,KAAK,IAAK,IAAI1D,YAAY,CAAC2D,iBAAiB,CAAC;MAAED,KAAK;MAAEE,MAAM,EAAE;IAAS,CAAE,CAAC,CAAC;GAE/F,CAAC;AACJ,CAAC,CAAC;AAEJ;;;;AAIA,OAAO,MAAM+C,KAAK,GAAIlG,OAGrB,IACCP,KAAK,CAAC4D,MAAM,CAAC9D,YAAY,CAACA,YAAY,EAAEQ,IAAI,CAACC,OAAO,CAAC,CAAC;AAExD,MAAMY,UAAU,gBAAGjB,MAAM,CAACwG,MAAM,CAAC;EAC/BhF,EAAE,EAAExB,MAAM,CAACyG,kBAAkB;EAC7BhF,KAAK,EAAEzB,MAAM,CAAC0G,MAAM;EACpB/E,WAAW,EAAE3B,MAAM,CAAC0G,MAAM;EAC1B9E,OAAO,EAAE5B,MAAM,CAACyG,kBAAkB;EAClC1E,SAAS,EAAE/B,MAAM,CAAC2G;CACnB,CAAC;AAEF,MAAMzF,cAAc,gBAAGlB,MAAM,CAACwG,MAAM,CAAC;EACnChF,EAAE,EAAExB,MAAM,CAACyG,kBAAkB;EAC7BhF,KAAK,EAAEzB,MAAM,CAAC0G,MAAM;EACpB/E,WAAW,EAAE3B,MAAM,CAAC0G,MAAM;EAC1B9E,OAAO,EAAE5B,MAAM,CAACyG,kBAAkB;EAClC1E,SAAS,EAAE/B,MAAM,CAAC4G;CACnB,CAAC;AAEF,MAAM9D,SAAS,gBAAG9C,MAAM,CAACwG,MAAM,CAAC;EAC9BpC,SAAS,EAAExE,YAAY,CAACiH,QAAQ;EAChCvC,QAAQ,EAAE1E,YAAY,CAACkH,OAAO;EAC9BvC,QAAQ,EAAEvE,MAAM,CAACkG;CAClB,CAAC","ignoreList":[]}
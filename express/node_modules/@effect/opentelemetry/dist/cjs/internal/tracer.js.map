{"version":3,"file":"tracer.js","names":["OtelApi","_interopRequireWildcard","require","Cause","Context","Effect","_Function","Layer","Option","EffectTracer","_Resource","_utils","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","OtelSpan","name","parent","context","links","kind","_tag","span","spanId","traceId","attributes","Map","sampled","status","constructor","contextApi","tracer","startTime","active","startSpan","nanosToHrTime","length","map","link","makeSpanContext","recordToAttributes","undefined","populateContext","value","trace","deleteSpan","spanContext","traceFlags","TraceFlags","SAMPLED","attribute","key","setAttribute","unknownToAttributeValue","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","exports","TracerProvider","GenericTag","Tracer","make","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","options","empty","add","traceState","match","createTraceState","onNone","onSome","currentOtelSpan","flatMap","succeed","fail","NoSuchElementException","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","zip","Resource","resource","provider","getTracer","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","otelContext","setSpan","setSpanContext","isRemote","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","dual","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
{"version":3,"file":"metrics.js","names":["ValueType","AggregationTemporality","DataPointType","InstrumentType","Arr","Effect","Layer","Metric","MetricKeyType","MetricState","Option","Resource","sdkName","MetricProducerImpl","resource","constructor","startTimes","Map","startTimeFor","name","hrTime","has","get","set","collect","_options","snapshot","unsafeSnapshot","hrTimeNow","currentHrTime","metricData","metricDataByName","addMetricData","data","push","descriptor","i","len","length","metricKey","metricState","attributes","reduce","tags","acc","label","key","value","descriptorFromKey","startTime","isCounterState","dataPoint","endTime","Number","count","dataPoints","dataPointType","SUM","isMonotonic","type","COUNTER","aggregationTemporality","CUMULATIVE","isGaugeState","GAUGE","isHistogramState","size","buckets","boundaries","allocate","counts","prev","boundary","min","max","sum","HISTOGRAM","isFrequencyState","freqKey","occurrences","isSummaryState","quantile","quantiles","toString","_tag","countDataPoint","sumDataPoint","descriptorMeta","unit","valueType","INT","DOUBLE","Promise","resolve","resourceMetrics","scopeMetrics","scope","metrics","errors","suffix","description","getOrElse","advice","time_unit","instrumentTypeFromKey","keyType","bigint","isHistogramKey","isGaugeKey","OBSERVABLE_GAUGE","isFrequencyKey","isCounterKey","incremental","UP_DOWN_COUNTER","now","Date","Math","floor","makeProducer","map","registerProducer","self","metricReader","options","acquireRelease","sync","reader","readers","Array","isArray","forEach","setMetricProducer","promise","all","shutdown","pipe","ignoreLogged","interruptible","timeoutOption","shutdownTimeout","layer","evaluate","scopedDiscard","flatMap","producer"],"sources":["../../../src/internal/metrics.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
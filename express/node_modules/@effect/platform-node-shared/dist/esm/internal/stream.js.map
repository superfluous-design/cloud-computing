{"version":3,"file":"stream.js","names":["SystemError","Cause","Channel","Chunk","Effect","Exit","Fiber","dual","Mailbox","Runtime","Stream","Readable","fromReadable","evaluate","onError","chunkSize","fromChannel","fromReadableChannel","Number","undefined","toString","readable","options","maxBytesNumber","maxBytes","acquireUseRelease","sync","stream","setEncoding","encoding","async","resume","string","bytes","once","err","fail","onFailure","succeed","on","chunk","Buffer","byteLength","Error","closed","destroy","toUint8Array","buffer","alloc","concat","length","fromDuplex","tap","zip","make","duplex","mailbox","readableOffer","embedInput","readableTake","writeInput","cause","failCause","zipRight","shutdown","pipeThroughDuplex","args","StreamTypeId","self","pipeThroughChannelOrFail","pipeThroughSimple","error","module","method","pathOrDescriptor","reason","message","String","writable","endOnDone","onDone","void","write","writeEffect","close","end","awaitRead","emit","done","_","iterator","Symbol","next","loop","item","success","value","unsafeOffer","unsafeDone","read","readChunkChannel","flatMap","takeAll","suspend","arr","push","unsafeFromArray","StreamAdapter","readLatch","fiber","constructor","runtime","unsafeMakeLatch","runFork","whenOpen","runForEachChunk","unsafeClose","addObserver","exit","isSuccess","squash","_read","_size","unsafeOpen","_destroy","callback","interrupt","_tag","toReadable","map","toReadableNever","defaultRuntime"],"sources":["../../../src/internal/stream.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
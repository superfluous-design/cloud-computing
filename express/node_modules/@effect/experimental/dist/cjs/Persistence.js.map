{"version":3,"file":"Persistence.js","names":["_Error","require","KeyValueStore","_interopRequireWildcard","Context","Duration","Effect","_Function","Layer","Option","ParseResult","PrimaryKey","Schema","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ErrorTypeId","exports","Symbol","for","PersistenceParseError","TypeIdError","make","method","error","reason","message","TreeFormatter","formatIssueSync","PersistenceBackingError","cause","BackingPersistenceTypeId","BackingPersistence","GenericTag","ResultPersistenceTypeId","ResultPersistence","layerResult","effect","gen","backing","of","options","storage","storeId","timeToLive","infinity","parse","key","value","mapError","deserializeExit","_","issue","encode","serializeExit","makeKey","symbol","identity","flatMap","match","onNone","succeedNone","onSome","asSome","getMany","keys","map","forEach","result","pipe","tapError","remove","option","ttl","decode","isZero","void","encoded","isFinite","some","none","clear","layerMemory","sync","stores","Map","getStore","store","undefined","clock","unsafeGet","unsafeCurrentTimeMillis","delete","unsafeTtlToExpires","layerKeyValueStore","prefix","s","try","JSON","catch","Array","isArray","expires","as","ignore","succeed","stringify","u","layerResultMemory","provide","layerResultKeyValueStore","_tag","toMillis"],"sources":["../../src/Persistence.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
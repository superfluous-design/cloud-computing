{"version":3,"file":"Cloudflare.js","names":["_cloudflareWorkers","require","Cause","_interopRequireWildcard","Effect","ManagedRuntime","_EventJournal","EventLogRemote","EventLogServer","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","EventLogDurableObject","DurableObject","runtime","constructor","options","ctx","env","setHibernatableWebSocketEventTimeout","make","storageLayer","webSocketMessage","ws","message","handleRequest","decodeRequest","ArrayBuffer","Uint8Array","TextEncoder","encode","chunks","Map","request","_tag","gen","storage","Storage","entries","encryptedEntries","map","encryptedEntry","entryId","PersistedEntry","iv","write","publicKey","send","encodeResponse","Ack","id","sequenceNumbers","_","sequence","changes","encodeChanges","peer","getWebSockets","change","pipe","runPromise","data","ChunkedMessage","join","startSequence","length","Changes","byteLength","split","Math","floor","random","webSocketError","_ws","error","runFork","logWarning","fail","webSocketClose","code","reason","fetch","webSocketPair","WebSocketPair","client","server","values","acceptWebSocket","flatMap","getId","tap","remoteId","Hello","RemoteId","Response","status","webSocket"],"sources":["../../../src/EventLogServer/Cloudflare.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
{"version":3,"file":"Cloudflare.js","names":["DurableObject","Cause","Effect","ManagedRuntime","RemoteId","EventLogRemote","EventLogServer","EventLogDurableObject","runtime","constructor","options","ctx","env","setHibernatableWebSocketEventTimeout","make","storageLayer","webSocketMessage","ws","message","handleRequest","decodeRequest","ArrayBuffer","Uint8Array","TextEncoder","encode","chunks","Map","request","_tag","gen","storage","Storage","entries","encryptedEntries","map","encryptedEntry","entryId","PersistedEntry","iv","write","publicKey","send","encodeResponse","Ack","id","sequenceNumbers","_","sequence","changes","encodeChanges","peer","getWebSockets","change","pipe","runPromise","data","ChunkedMessage","join","startSequence","length","Changes","byteLength","split","Math","floor","random","webSocketError","_ws","error","runFork","logWarning","fail","webSocketClose","code","reason","fetch","webSocketPair","WebSocketPair","client","server","Object","values","acceptWebSocket","flatMap","getId","tap","remoteId","Hello","Response","status","webSocket"],"sources":["../../../src/EventLogServer/Cloudflare.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
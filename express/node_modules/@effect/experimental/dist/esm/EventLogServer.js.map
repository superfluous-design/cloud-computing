{"version":3,"file":"EventLogServer.js","names":["HttpServerRequest","HttpServerResponse","MsgPack","Chunk","Context","Effect","FiberMap","Layer","Mailbox","PubSub","RcMap","Schema","Uuid","EntryId","makeRemoteId","EncryptedRemoteEntry","Ack","Changes","ChunkedMessage","decodeRequest","encodeResponse","Hello","Pong","constChunkSize","makeHandler","gen","storage","Storage","remoteId","getId","chunkId","handler","socket","subscriptions","make","writeRaw","writer","chunks","Map","latestSequence","writeGen","response","data","_tag","byteLength","id","part","split","write","fork","handleRequest","request","encryptedEntries","length","sequenceNumbers","entries","map","encryptedEntry","entryId","PersistedEntry","iv","encrypted","publicKey","sequence","e","changes","startSequence","takeAll","pipe","flatMap","latestEntries","entry","push","void","toReadonlyArray","forever","scoped","run","remove","join","catchAllCause","logDebug","annotateLogs","module","makeHandlerHttp","upgrade","empty","Class","Uint8ArrayFromSelf","fromMsgPack","schema","encode","encodeSync","entryIdString","stringify","Tag","makeStorageMemory","knownIds","journals","ensureJournal","journal","get","set","pubsubs","lookup","_publicKey","acquireRelease","unbounded","shutdown","idleTimeToLive","of","succeed","active","keys","pubsub","includes","undefined","idString","has","unsafeOffer","sync","slice","mailbox","queue","subscribe","offerAll","takeBetween","Number","MAX_SAFE_INTEGER","tap","chunk","forkScoped","interruptible","layerStorageMemory"],"sources":["../../src/EventLogServer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
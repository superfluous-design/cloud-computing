{"version":3,"file":"Entity.js","names":["RpcClient","RpcGroup","RpcServer","Arr","Context","Data","Effect","Equal","Exit","Hash","Layer","Mailbox","Option","Predicate","Scope","EntityAddress","EntityType","Envelope","hashString","ResourceMap","RunnerAddress","ShardId","ShardingConfig","Snowflake","TypeId","Symbol","for","isEntity","u","hasProperty","Proto","symbol","structure","type","that","annotate","tag","value","fromRpcGroup","protocol","annotateRpcs","annotateContext","context","annotateRpcsContext","client","shardingTag","pipe","flatMap","sharding","makeClient","toLayer","build","options","registerEntity","isEffect","succeed","effectDiscard","toLayerMailbox","buildHandlers","gen","behaviour","mailbox","make","handler","envelope","async","resume","unsafeOffer","resumes","set","handlers","rpc","requests","keys","Map","complete","request","exit","sync","get","delete","replier","fail","error","failCause","cause","catchAllCause","values","void","interruptible","forkScoped","concurrency","self","Object","create","CurrentAddress","Tag","CurrentRunnerAddress","Request","Class","lastSentChunkValue","lastSentChunk","map","chunk","lastNonEmpty","nextSequence","isNone","sequence","GenericTag","makeTestClient","fnUntraced","entity","layer","config","makeShardId","entityId","Math","abs","numberOfShards","snowflakeGen","makeGenerator","runnerAddress","host","port","entityMap","of","contextWith","toHandlersContext","provide","add","omit","entityEntry","dieMessage","address","entityType","shardId","provideService","server","makeNoSerialization","onFromServer","response","write","supportsAck","generateRequestId","unsafeNext","onFromClient","message","_tag","payload","requestId","id","none"],"sources":["../../src/Entity.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
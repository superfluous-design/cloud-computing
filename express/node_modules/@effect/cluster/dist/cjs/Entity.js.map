{"version":3,"file":"Entity.js","names":["RpcClient","_interopRequireWildcard","require","RpcGroup","RpcServer","Arr","Context","Data","Effect","Equal","Exit","Hash","Layer","Mailbox","Option","Predicate","_Scope","_EntityAddress","_EntityType","Envelope","_hash","_resourceMap","_RunnerAddress","ShardId","_ShardingConfig","Snowflake","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","TypeId","exports","Symbol","for","isEntity","u","hasProperty","Proto","symbol","structure","type","that","annotate","tag","value","fromRpcGroup","protocol","annotateRpcs","annotateContext","context","annotateRpcsContext","client","shardingTag","pipe","flatMap","sharding","makeClient","toLayer","build","options","registerEntity","isEffect","succeed","effectDiscard","toLayerMailbox","buildHandlers","gen","behaviour","mailbox","make","handler","envelope","async","resume","unsafeOffer","resumes","handlers","rpc","requests","keys","Map","complete","request","exit","sync","delete","replier","fail","error","failCause","cause","catchAllCause","values","void","interruptible","forkScoped","concurrency","self","create","EntityType","CurrentAddress","Tag","CurrentRunnerAddress","Request","Class","lastSentChunkValue","lastSentChunk","map","chunk","lastNonEmpty","nextSequence","isNone","sequence","GenericTag","makeTestClient","fnUntraced","entity","layer","config","ShardingConfig","makeShardId","entityId","Math","abs","hashString","numberOfShards","snowflakeGen","makeGenerator","runnerAddress","RunnerAddress","host","port","entityMap","of","contextWith","toHandlersContext","provide","add","omit","Scope","entityEntry","dieMessage","ResourceMap","address","EntityAddress","entityType","shardId","provideService","server","makeNoSerialization","onFromServer","response","write","supportsAck","generateRequestId","unsafeNext","onFromClient","message","_tag","payload","requestId","id","none"],"sources":["../../src/Entity.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}